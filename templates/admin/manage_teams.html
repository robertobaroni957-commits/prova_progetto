{% extends "base.html" %}

{% block title %}Gestione Team{% endblock %}
{% block page_title %}Gestione Team{% endblock %}

{% block content %}
<!-- üîß Creazione nuovo team -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-primary text-white">‚ûï Aggiungi Nuovo Team</div>
  <div class="card-body">
    <form method="POST" action="{{ url_for('admin_teams.manage_teams') }}">
      <input type="hidden" name="action" value="create">
      <div class="row g-3">
        <div class="col-md-4">
          <label for="name" class="form-label">Nome Team:</label>
          <input type="text" name="name" id="name" class="form-control" required>
        </div>
        <div class="col-md-2">
          <label for="category" class="form-label">Categoria:</label>
          <select name="category" id="category" class="form-select" required>
            {% for cat in ['A', 'B', 'C', 'D'] %}
              <option value="{{ cat }}">{{ cat }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <label for="division" class="form-label">Divisione:</label>
          <select name="division" id="division" class="form-select" required>
            {% for div in ['1', '2', '3'] %}
              <option value="{{ div }}">{{ div }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4">
          <label for="captain_id" class="form-label">Capitano:</label>
          <select name="captain_id" id="captain_id" class="form-select">
            <option value="">-- Nessuno --</option>
            {% for rider in riders %}
              <option value="{{ rider.zwift_power_id }}">{{ rider.name }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="text-end mt-3">
        <button type="submit" class="btn btn-success">‚ûï Aggiungi Team</button>
      </div>
    </form>
  </div>
</div>

<!-- üìã Team esistenti -->
<div class="card shadow-sm">
  <div class="card-header bg-secondary text-white">üìã Team Esistenti</div>
  <div class="card-body">
    <table class="table table-bordered table-sm align-middle">
      <thead class="table-light">
        <tr>
          <th>Nome</th>
          <th>Categoria</th>
          <th>Divisione</th>
          <th>Capitano Attuale</th>
          <th>Modifica Capitano</th>
          <th>Gestione</th>
          <th>Salva</th>
          <th>Elimina</th>
        </tr>
      </thead>
      <tbody>
        {% for team in teams %}
        <tr>
          <form method="POST" action="{{ url_for('admin_teams.manage_teams') }}">
            <input type="hidden" name="action" value="update">
            <input type="hidden" name="team_id" value="{{ team.id }}">
            <td><input type="text" name="name" value="{{ team.name }}" class="form-control" required></td>
            <td>
              <select name="category" class="form-select" required>
                {% for cat in ['A', 'B', 'C', 'D'] %}
                  <option value="{{ cat }}" {% if team.category == cat %}selected{% endif %}>{{ cat }}</option>
                {% endfor %}
              </select>
            </td>
            <td>
              <select name="division" class="form-select" required>
                {% for div in ['1', '2', '3'] %}
                  <option value="{{ div }}" {% if team.division == div %}selected{% endif %}>{{ div }}</option>
                {% endfor %}
              </select>
            </td>
            <td>{{ team.captain_name or '‚Äî' }}</td>
            <td>
              <select name="captain_id" class="form-select">
                <option value="">-- Nessuno --</option>
                {% for rider in riders %}
                  <option value="{{ rider.zwift_power_id }}"
        {% if rider.zwift_power_id == team.captain_zwift_id %}selected{% endif %}>
  {{ rider.name }}
</option>
                {% endfor %}
              </select>
            </td>
            <td>
              <a href="{{ url_for('admin_teams.manage_team_members', team_id=team.id) }}"
                 class="btn btn-outline-primary btn-sm">üë• Gestisci</a>
            </td>
            <td>
              <button type="submit" class="btn btn-outline-success btn-sm">üíæ</button>
            </td>
          </form>
          <td>
            <form method="POST" action="{{ url_for('admin_teams.manage_teams') }}"
                  onsubmit="return confirm('Eliminare il team {{ team.name }}?');">
              <input type="hidden" name="action" value="delete">
              <input type="hidden" name="team_id" value="{{ team.id }}">
              <button type="submit" class="btn btn-outline-danger btn-sm">üóëÔ∏è</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>ZRL Manager Â· {% block title %}{% endblock %}</title>

  <!-- Responsive -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Font & Bootstrap -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 1rem !important;
      }
      header h1 {
        font-size: 1.1rem;
      }
      .offcanvas-body .nav-link {
        font-size: 1rem;
        padding: 0.75rem 0;
      }
    }
  </style>
</head>

<body class="d-flex">

  {# ğŸ”’ Sidebar desktop (fissa) #}
  {% set role = session.get('user_role') %}
  {% if session.get('user_id') and role %}
    <aside class="sidebar bg-white p-4 border-end shadow-sm d-none d-md-block"
           style="min-width: 260px; max-height: 100vh; overflow-y: auto;">
      <h2 class="mb-4 text-primary fw-bold">ğŸ ZRL Manager</h2>

      <!-- Dashboard -->
      <h6 class="text-muted text-uppercase">Dashboard</h6>
      <a href="{{ url_for('admin_panel.admin_dashboard') }}"
         class="nav-link d-flex align-items-center gap-3 py-2 {% if request.endpoint == 'admin_panel.admin_dashboard' %}active fw-bold text-primary{% endif %}">
        <i class="bi bi-bar-chart-fill text-info fs-5"></i> Dashboard ZRL
      </a>

      <hr>

      <!-- Importazioni -->
      <h6 class="text-muted text-uppercase">Importazioni</h6>
      <a href="{{ url_for('scrape.scrape') }}" class="nav-link d-flex align-items-center gap-3 py-2">
        <i class="bi bi-arrow-repeat text-warning fs-5"></i> Da ZwiftPower
      </a>
      <a href="{{ url_for('admin_import_riders.import_zrl_riders') }}" class="nav-link d-flex align-items-center gap-3 py-2">
        <i class="bi bi-person-check-fill text-success fs-5"></i> Rider ZRL
      </a>
      <a href="{{ url_for('import_wtrl.import_wtrl_races') }}" class="nav-link d-flex align-items-center gap-3 py-2">
        <i class="bi bi-calendar-fill text-info fs-5"></i> Importa gare da WTRL
      </a>

      <h6 class="text-muted text-uppercase mt-4">Stagioni & Round</h6>
      <a href="{{ url_for('admin_races.import_races') }}" class="nav-link d-flex align-items-center gap-3 py-2">
        <i class="bi bi-calendar-range text-success fs-5"></i> Gestione Stagioni e Round
      </a>

      <h6 class="text-muted text-uppercase mt-4">Gare</h6>
      <a href="#" class="nav-link d-flex align-items-center gap-3 py-2 disabled">
        <i class="bi bi-people-fill text-danger fs-5"></i> TBC - Future funzioni
      </a>
      <a href="{{ url_for('admin_lineup.lineup_report_all') }}" class="nav-link d-flex align-items-center gap-3 py-2">
        <i class="bi bi-file-text-fill text-info fs-5"></i> Report Formazioni
      </a>
      <a href="{{ url_for('admin_races.manage_captains') }}" class="nav-link d-flex align-items-center gap-3 py-2">
        <i class="bi bi-person-badge-fill text-info fs-5"></i> Gestione Capitani
      </a>

      <h6 class="text-muted text-uppercase mt-4">Team</h6>
      <a href="{{ url_for('admin_teams.manage_teams') }}"
         class="nav-link d-flex align-items-center gap-3 py-2 {% if request.endpoint == 'admin_teams.manage_teams' %}active fw-bold text-primary{% endif %}">
        <i class="bi bi-people text-secondary fs-5"></i> Gestione Team
      </a>

      <hr>

      <a href="{{ url_for('auth.logout') }}" class="nav-link d-flex align-items-center gap-3 py-2 text-danger">
        <i class="bi bi-box-arrow-right fs-5"></i> Logout
      </a>
    </aside>
  {% endif %}


  {# ğŸ“± Sidebar mobile (offcanvas) #}
  <div class="offcanvas offcanvas-start bg-white" tabindex="-1" id="mobileSidebar">
    <div class="offcanvas-header border-bottom">
      <h5 class="offcanvas-title fw-bold text-primary">ğŸ ZRL Manager</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      {% if session.get('user_id') and role %}
        {# Riutilizza la stessa struttura della sidebar desktop #}
        <div class="nav flex-column">
          <h6 class="text-muted text-uppercase">Dashboard</h6>
          <a href="{{ url_for('admin_panel.admin_dashboard') }}"
             class="nav-link py-2 {% if request.endpoint == 'admin_panel.admin_dashboard' %}fw-bold text-primary{% endif %}">
             <i class="bi bi-bar-chart-fill me-2"></i> Dashboard ZRL
          </a>
          <hr>

          <h6 class="text-muted text-uppercase">Importazioni</h6>
          <a href="{{ url_for('scrape.scrape') }}" class="nav-link py-2">
            <i class="bi bi-arrow-repeat me-2 text-warning"></i> Da ZwiftPower
          </a>
          <a href="{{ url_for('admin_import_riders.import_zrl_riders') }}" class="nav-link py-2">
            <i class="bi bi-person-check-fill me-2 text-success"></i> Rider ZRL
          </a>
          <a href="{{ url_for('import_wtrl.import_wtrl_races') }}" class="nav-link py-2">
            <i class="bi bi-calendar-fill me-2 text-info"></i> Importa gare da WTRL
          </a>

          <h6 class="text-muted text-uppercase mt-3">Stagioni & Round</h6>
          <a href="{{ url_for('admin_races.import_races') }}" class="nav-link py-2">
            <i class="bi bi-calendar-range me-2 text-success"></i> Gestione Stagioni e Round
          </a>

          <h6 class="text-muted text-uppercase mt-3">Gare</h6>
          <a href="{{ url_for('admin_lineup.lineup_report_all') }}" class="nav-link py-2">
            <i class="bi bi-file-text-fill me-2 text-info"></i> Report Formazioni
          </a>
          <a href="{{ url_for('admin_races.manage_captains') }}" class="nav-link py-2">
            <i class="bi bi-person-badge-fill me-2 text-info"></i> Gestione Capitani
          </a>

          <h6 class="text-muted text-uppercase mt-3">Team</h6>
          <a href="{{ url_for('admin_teams.manage_teams') }}" class="nav-link py-2">
            <i class="bi bi-people me-2 text-secondary"></i> Gestione Team
          </a>

          <hr>
          <a href="{{ url_for('auth.logout') }}" class="nav-link text-danger py-2">
            <i class="bi bi-box-arrow-right me-2"></i> Logout
          </a>
        </div>
      {% endif %}
    </div>
  </div>

  {# ğŸ”¹ Contenuto principale #}
  <div class="main-content flex-grow-1 p-4">
    <header class="d-flex justify-content-between align-items-center mb-4">
      <div class="d-flex align-items-center gap-2">
        <!-- Pulsante menu visibile solo su mobile -->
        <button class="btn btn-outline-secondary d-md-none" type="button"
                data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar"
                aria-controls="mobileSidebar">
          <i class="bi bi-list fs-4"></i>
        </button>
        <h1 class="h4 m-0">{{ page_title or "ZRL Manager" }}</h1>
      </div>
      <div class="text-end">
        {% if session.get('user_email') %}
          <span class="me-3 d-none d-sm-inline">ğŸ‘‹ {{ session.get('user_email') }}</span>
        {% endif %}
        {% if role %}
          <span class="badge bg-primary">{{ role|capitalize }}</span>
        {% endif %}
      </div>
    </header>

    {# ğŸ”” Messaggi flash #}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} d-flex align-items-center" role="alert">
            <i class="bi bi-{{ 'check-circle' if category == 'success' else 'exclamation-triangle' if category == 'warning' else 'x-circle' if category == 'danger' else 'info-circle' }} me-2"></i>
            {{ message|safe }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
